# k8s-reporter

![Version: 0.4.0](https://img.shields.io/badge/Version-0.4.0-informational?style=flat-square)

A Helm chart for installing the Merkely K8S reporter as a cronjob.
The chart allows you to create a Kubernetes cronjob and all its necessary RBAC to report running images to Merkely at a given cron schedule.

## Prerequisites

- A Kubernetes cluster
- Helm v3.0+

## Installing the chart

### Installing from source

You can install the Merkely reporter Helm chart from source code:

```shell
git clone https://github.com/merkely-development/reporter.git
cd reporter/charts/k8s-reporter
helm install [RELEASE-NAME] . -f [VALUES-FILE-PATH]
```

### Installing from the Helm Repository

To install this chart via the Helm chart repository:

```shell
helm repo add merkely https://charts.merkely.com/
helm repo update
helm install [RELEASE-NAME] merkely/k8s-reporter -f [VALUES-FILE-PATH]
```

## Upgrading the chart

### Upgrading from source

```shell
helm upgrade [RELEASE-NAME] .
```

### Upgrading from the Helm chart repository

```shell
helm upgrade [RELEASE-NAME] merkely/k8s-reporter
```

## Configurations
| Key | Type | Default | Description |
|-----|------|---------|-------------|
| cronSchedule | string | `"*/5 * * * *"` | the cron schedule at which the reporter is triggered to report to Merkely   |
| fullnameOverride | string | `""` | overrides the fullname used for the created k8s resources. It has higher precedence than `nameOverride` |
| image.pullPolicy | string | `"IfNotPresent"` | the merkely reporter image pull policy |
| image.repository | string | `"ghcr.io/merkely-development/merkely-cli"` | the merkely reporter image repository |
| image.tag | string | `"v1.1.0"` | the merkely reporter image tag, overrides the image tag whose default is the chart appVersion. |
| merkelyApiToken.secretKey | string | `""` | the name of the key in the secret data which containts the Merkely API token |
| merkelyApiToken.secretName | string | `""` | the name of the secret containing the Merkely API token |
| nameOverride | string | `""` | overrides the name used for the created k8s resources. If `fullnameOverride` is provided, it has higher precedence than this one |
| podAnnotations | object | `{}` |  |
| reporterConfig.dryRun | bool | `false` | whether the dry run mode is enabled or not. In dry run mode, the reporter logs the reports to stdout and does not send them to Merkely. |
| reporterConfig.merkelyEnvironmentName | string | `""` | the name of Merkely environment that the k8s cluster/namespace correlates to |
| reporterConfig.merkelyOwner | string | `""` | the name of the Merkely owner (Org) |
| reporterConfig.namespaces | string | `""` | the namespaces which represent the environment. It is a comma separated list of namespace name regex patterns. e.g. `^prod$,^dev-*` reports for the `prod` namespace and any namespace that starts with `dev-` leave this unset if you want to report what is running in the entire cluster |
| resources.limits.cpu | string | `"100m"` | the cpu limit |
| resources.limits.memory | string | `"256Mi"` | the memory limit |
| resources.requests.memory | string | `"64Mi"` | the memory request |
| serviceAccount.annotations | object | `{}` | annotations to add to the service account |
| serviceAccount.create | bool | `true` | specifies whether a service account should be created |
| serviceAccount.name | string | `""` | the name of the service account to use. If not set and create is true, a name is generated using the fullname template |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.5.0](https://github.com/norwoodj/helm-docs/releases/v1.5.0)

