<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Preparing the tutorial # To follow the tutorial you need to:
Install the kosli CLI . Get your Kosli API token . Set the KOSLI_API_TOKEN environment variable: export KOSLI_API_TOKEN=<paste-your-kosli-API-token-here> Set the KOSLI_OWNER environment variable to your Kosli organization name: export KOSLI_OWNER=<paste-your-kosli-organization-name> For this tutorial you will simulate a system with source code, a build system, and a running server. There is a script to help you run these simulations, so you won't need to type too many commands."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:image" content="https://docs.kosli.com/images/kosli.jpg"><meta name=twitter:image content="https://docs.kosli.com/images/kosli.jpg"><meta property="og:title" content><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://docs.kosli.com/use_cases/simulating_a_devops_system/"><title>Simulating a DevOps system</title><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=stylesheet href=/book.min.e789a4fc4414484ea0dd1204f9a7cec2abc5e562551a43064ab3f6bca33dd66a.css integrity="sha256-54mk/EQUSE6g3RIE+afOwqvF5WJVGkMGSrP2vKM91mo=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.d46c0a3f928a9f6a459defb66b855f04f82e1abb383b2176fe762b4c6a241614.js integrity="sha256-1GwKP5KKn2pFne+2a4VfBPguGrs4OyF2/nYrTGokFhQ=" crossorigin=anonymous></script>
<script src=https://cdn.usefathom.com/script.js data-site=AUFUAQWT data-excluded-domains=localhost defer></script>
<link rel=alternate type=application/rss+xml href=https://docs.kosli.com/use_cases/simulating_a_devops_system/index.xml title="Kosli developer documentation"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Kosli developer documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-8d07877860004719ef46751318e056d1 class=toggle>
<label for=section-8d07877860004719ef46751318e056d1 class="flex justify-between"><a href=https://docs.kosli.com/introducing_kosli/>Introducing Kosli</a></label><ul><li><a href=https://docs.kosli.com/introducing_kosli/organizations/>Organizations</a></li><li><a href=https://docs.kosli.com/introducing_kosli/environments/>Environments</a></li><li><a href=https://docs.kosli.com/introducing_kosli/pipelines/>Pipelines</a></li><li><a href=https://docs.kosli.com/introducing_kosli/fingerprint/>Fingerprint</a></li><li><a href=https://docs.kosli.com/introducing_kosli/cli/>CLI</a></li><li><a href=https://docs.kosli.com/introducing_kosli/web_ui/>Web UI</a></li></ul></li><li><input type=checkbox id=section-acdc30ff5cf57e4ff3a5b04fe43650db class=toggle>
<label for=section-acdc30ff5cf57e4ff3a5b04fe43650db class="flex justify-between"><a href=https://docs.kosli.com/getting_started/>Getting started</a></label><ul><li><a href=https://docs.kosli.com/getting_started/getting_started_with_kosli/>Quick start</a></li><li><a href=https://docs.kosli.com/getting_started/installation/>Install Kosli</a></li><li><a href=https://docs.kosli.com/getting_started/use_kosli_in_ci_systems/>Use Kosli in CI Systems</a></li></ul></li><li><input type=checkbox id=section-fdba2124b9f6bc01f478608f07a6e592 class=toggle checked>
<label for=section-fdba2124b9f6bc01f478608f07a6e592 class="flex justify-between"><a href=https://docs.kosli.com/use_cases/>Use cases</a></label><ul><li><a href=https://docs.kosli.com/use_cases/following_a_git_commit_to_runtime_environments/>Following a git commit to runtime environments</a><ul></ul></li><li><a href=https://docs.kosli.com/use_cases/tracing_a_production_incident_back_to_git_commits/>Tracing a production incident back to git commits</a><ul></ul></li><li><a href=https://docs.kosli.com/use_cases/simulating_a_devops_system/ class=active>Simulating a DevOps system</a><ul></ul></li></ul></li><li><input type=checkbox id=section-23c01066495116db89ec68655dfc73ed class=toggle>
<label for=section-23c01066495116db89ec68655dfc73ed class="flex justify-between"><a href=https://docs.kosli.com/how_to/>How to</a></label><ul><li><a href=https://docs.kosli.com/how_to/record/>Record</a></li><li><a href=https://docs.kosli.com/how_to/connect/>Connect</a></li><li><a href=https://docs.kosli.com/how_to/search/>Search</a></li></ul></li><li><input type=checkbox id=section-3993beb65ef7e76a7dbe6e66c07255ac class=toggle>
<label for=section-3993beb65ef7e76a7dbe6e66c07255ac class="flex justify-between"><a href=https://docs.kosli.com/client_reference/>Reference</a></label><ul><li><a href=https://docs.kosli.com/client_reference/kosli/>kosli</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_get/>kosli approval get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_ls/>kosli approval ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_get/>kosli artifact get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_ls/>kosli artifact ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_artifact/>kosli assert artifact</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_bitbucket-pullrequest/>kosli assert bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_environment/>kosli assert environment</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_github-pullrequest/>kosli assert github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_status/>kosli assert status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_completion/>kosli completion</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_get/>kosli deployment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_ls/>kosli deployment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_allowedartifacts_add/>kosli environment allowedartifacts add</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_declare/>kosli environment declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_diff/>kosli environment diff</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_get/>kosli environment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_inspect/>kosli environment inspect</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_log/>kosli environment log</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_ls/>kosli environment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_rename/>kosli environment rename</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_docker/>kosli environment report docker</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_ecs/>kosli environment report ecs</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_k8s/>kosli environment report k8s</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_lambda/>kosli environment report lambda</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_s3/>kosli environment report s3</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_server/>kosli environment report server</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_expect_deployment/>kosli expect deployment</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_fingerprint/>kosli fingerprint</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_assert/>kosli pipeline approval assert</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_report/>kosli pipeline approval report</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_request/>kosli pipeline approval request</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_creation/>kosli pipeline artifact report creation</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_bitbucket-pullrequest/>kosli pipeline artifact report evidence bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_generic/>kosli pipeline artifact report evidence generic</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_github-pullrequest/>kosli pipeline artifact report evidence github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_test/>kosli pipeline artifact report evidence test</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_declare/>kosli pipeline declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_inspect/>kosli pipeline inspect</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_ls/>kosli pipeline ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_search/>kosli search</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_status/>kosli status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_version/>kosli version</a></li></ul></li><li><input type=checkbox id=section-d06928ff9c11121b26f141ced850796c class=toggle>
<label for=section-d06928ff9c11121b26f141ced850796c class="flex justify-between"><a href=https://docs.kosli.com/helm/>Helm</a></label><ul><li><a href=https://docs.kosli.com/helm/helm_chart/>Kubernetes Reporter Helm Chart</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Simulating a DevOps system</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><h4 class=toc-title>On this page:</h4><nav id=TableOfContents><ul><li><a href=#preparing-the-tutorial>Preparing the tutorial</a></li><li><a href=#environment>Environment</a><ul><li><a href=#creating-a-kosli-environment>Creating a Kosli environment</a></li><li><a href=#reporting-the-software-running-in-your-environment>Reporting the software running in your environment</a></li></ul></li><li><a href=#pipelines>Pipelines</a><ul><li><a href=#creating-a-kosli-pipeline>Creating a Kosli pipeline</a></li><li><a href=#building-artifacts-and-reporting-them-to-kosli>Building artifacts and reporting them to Kosli</a></li></ul></li><li><a href=#deployments>Deployments</a><ul><li><a href=#deploying-software-to-the-server-and-reporting-the-deployment-to-kosli>Deploying software to the server and reporting the deployment to Kosli</a></li></ul></li></ul></nav></aside></header><div class=content-container><article class=markdown><h1 id=preparing-the-tutorial>Preparing the tutorial
<a class=anchor href=#preparing-the-tutorial>#</a></h1><p>To follow the tutorial you need to:</p><ul><li><a href=/getting_started/installation>Install the <code>kosli</code> CLI
</a>.</li><li><a href=/getting_started/installation#getting-your-kosli-api-token>Get your Kosli API token
</a>.</li><li>Set the KOSLI_API_TOKEN environment variable:<div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export KOSLI_API_TOKEN<span style=color:#f92672>=</span>&lt;paste-your-kosli-API-token-here&gt;
</span></span></code></pre></div></li><li>Set the KOSLI_OWNER environment variable to your Kosli organization name:<div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export KOSLI_OWNER<span style=color:#f92672>=</span>&lt;paste-your-kosli-organization-name&gt;
</span></span></code></pre></div></li></ul><p>For this tutorial you will simulate a system with source code, a build system, and a running server.
There is a script to help you run these simulations, so you won't need to type too many commands.</p><p>You can download the script from here:
<a href=https://raw.githubusercontent.com/kosli-dev/cli/main/simulation_commands.bash target=_blank>https://raw.githubusercontent.com/kosli-dev/cli/main/simulation_commands.bash</a></p><p>or from the command line with:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd /tmp
</span></span><span style=display:flex><span>curl -O https://raw.githubusercontent.com/kosli-dev/cli/main/simulation_commands.bash
</span></span></code></pre></div><p>Source the simulation commands so you can use them later on in the examples:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>source simulation_commands.bash
</span></span></code></pre></div><p>To see what a command (eg create_git_repo_in_tmp) in the simulation is actually doing run:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>type create_git_repo_in_tmp
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>create_git_repo_in_tmp is a function
</span></span><span style=display:flex><span>create_git_repo_in_tmp () 
</span></span><span style=display:flex><span>{ 
</span></span><span style=display:flex><span>    pushd /tmp;
</span></span><span style=display:flex><span>    mkdir try-kosli;
</span></span><span style=display:flex><span>    ...
</span></span></code></pre></div><p>Create the git repo and simulate a build and deployment to the server:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>create_git_repo_in_tmp
</span></span><span style=display:flex><span>simulate_build
</span></span><span style=display:flex><span>simulate_deployment
</span></span></code></pre></div><p>While you're going through the getting started guide feel free to explore the
functionality by updating the source code, building and deploying new versions.</p><blockquote class="book-hint info"><h2 id=using-a-web-browser>Using a web browser
<a class=anchor href=#using-a-web-browser>#</a></h2><p>As you go through the guide you can also check your progress from
<a href=https://app.kosli.com target=_blank>your browser
</a>.</p><p>In the upper left corner there is a house icon. Next to it you can select
which organization you want to view. Your personal organization
has the same name as your github login name, and is the organization you will
be using in this guide.</p></blockquote><h1 id=environment>Environment
<a class=anchor href=#environment>#</a></h1><p>A Kosli environment stores information about
what software is running in your actual runtime environment (server, Kubernetes cluster, AWS, etc.)</p><p>A typical setup reports what is running on the
staging server and on the production server. To report what is
running you run the Kosli CLI command periodically. The Kosli CLI will
detect the version of the software you are currently running and report
it to the Kosli environment.</p><h2 id=creating-a-kosli-environment>Creating a Kosli environment
<a class=anchor href=#creating-a-kosli-environment>#</a></h2><p>To follow the examples make sure you have followed the instructions in Local setup</p><p>Create a Kosli environment:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment declare <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --environment-type server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;Production server (for kosli getting started)&#34;</span>
</span></span></code></pre></div><p>You can immediately verify that the Kosli environment was created:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment ls
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>NAME        TYPE    LAST REPORT  LAST MODIFIED
</span></span><span style=display:flex><span>production  server               2022-08-16T07:53:43+02:00
</span></span></code></pre></div><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment inspect production
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Name:              production
</span></span><span style=display:flex><span>Type:              server
</span></span><span style=display:flex><span>Description:       Production server (for kosli getting started)
</span></span><span style=display:flex><span>State:             N/A
</span></span><span style=display:flex><span>Last Reported At:  N/A
</span></span></code></pre></div><p>In the web interface you can select the <strong>Environments</strong> menu on the left.
It will show you that you have a <em>production</em> environment and that
no reports have been received.</p><h2 id=reporting-the-software-running-in-your-environment>Reporting the software running in your environment
<a class=anchor href=#reporting-the-software-running-in-your-environment>#</a></h2><p>Simulate a report from your server by reporting two dummy files for the web and
database applications:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment report server production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/web_*bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/db_*.bin
</span></span></code></pre></div><p>You can see that the server has started, and how long it has been running for:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment log production
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>SNAPSHOT  FROM                  TO   DURATION
</span></span><span style=display:flex><span>1         16 Aug 22 07:54 CEST  now  11 seconds
</span></span></code></pre></div><p>Get a more detailed view of what is currently running on the server:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment get production
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>COMMIT  ARTIFACT                                                                       PIPELINE  RUNNING_SINCE  REPLICAS
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/web_1.bin                                          N/A       2 minutes ago  1
</span></span><span style=display:flex><span>        Fingerprint: a7a87c332500a40f9a01b811ec75f51b40188a3dabd205feb0fa7c3eafb25fbe                           
</span></span><span style=display:flex><span>                                                                                                           
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/db_1.bin                                           N/A       2 minutes ago  1
</span></span><span style=display:flex><span>        Fingerprint: 0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af                           
</span></span></code></pre></div><p>If you refresh the environment page in the web browser you can see that there is
a timestamp for when the environment changed. Pressing the <em>production</em> link
gives you a detailed view of what is running now.</p><p>Typically, a server periodically sends a report of what is currently running to Kosli. But Kosli
will only create a new snapshot if the report shows changes compared to the previous snapshot, so resending the same environment report
several times will not lead to duplication of snapshots.</p><p>Send an environment report:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment report server production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/web_*bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/db_*.bin
</span></span></code></pre></div><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment log production
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>SNAPSHOT  FROM                  TO   DURATION
</span></span><span style=display:flex><span>1         16 Aug 22 07:54 CEST  now  11 seconds
</span></span></code></pre></div><p>Simulate an update of the web application to a new version, build and deploy it:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>update_web_src
</span></span><span style=display:flex><span>simulate_build
</span></span><span style=display:flex><span>simulate_deployment
</span></span></code></pre></div><p>Report what is now running on the server:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment report server production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/web_*bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/db_*.bin
</span></span></code></pre></div><p>You can see Kosli has created a new snapshot:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment log production
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>SNAPSHOT  FROM                  TO                    DURATION
</span></span><span style=display:flex><span>2         16 Aug 22 07:58 CEST  now                   9 seconds
</span></span><span style=display:flex><span>1         16 Aug 22 07:54 CEST  16 Aug 22 07:58 CEST  4 minutes
</span></span></code></pre></div><p>You can see that you are currently running web version 2 in production:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment get production
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>COMMIT  ARTIFACT                                                                       PIPELINE  RUNNING_SINCE   REPLICAS
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/web_2.bin                                          N/A       39 seconds ago  1
</span></span><span style=display:flex><span>        Fingerprint: cbc92ce1291830382ec23b95efc213d6e1725b5157bcb2927d48296b61c86746                            
</span></span><span style=display:flex><span>                                                                                                            
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/db_1.bin                                           N/A       6 minutes ago   1
</span></span><span style=display:flex><span>        Fingerprint: 0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af                            
</span></span></code></pre></div><p>Here, using the bare environment name (eg production) always refers to the latest snapshot
in that environment. You can also use the
Kosli CLI to check what was running in previous snapshots.
Find what was running in snapshot #1 in production:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment get production#1
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>COMMIT  ARTIFACT                                                                       PIPELINE  RUNNING_SINCE  REPLICAS
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/web_1.bin                                          N/A       7 minutes ago  1
</span></span><span style=display:flex><span>        Fingerprint: a7a87c332500a40f9a01b811ec75f51b40188a3dabd205feb0fa7c3eafb25fbe                           
</span></span><span style=display:flex><span>                                                                                                           
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/db_1.bin                                           N/A       7 minutes ago  1
</span></span><span style=display:flex><span>        Fingerprint: 0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af                           
</span></span></code></pre></div><p>In the web interface you should now also be able to see 2 snapshots. The Log
tab should show what changed in snapshot 1 and snapshot 2.</p><h1 id=pipelines>Pipelines
<a class=anchor href=#pipelines>#</a></h1><p>A Kosli pipeline stores information about what happens in your build system.
The output of the build system is called an <em>artifact</em> in Kosli. This can be
an application, a docker image, documentation, a filesystem, etc.</p><p>You use the Kosli CLI to report information about the creation of an
artifact to the Kosli pipeline.</p><p>A Kosli pipeline can also be used to store any information related to
the artifact you have built, like test results, manual approvals,
pull-requests, and so on.</p><h2 id=creating-a-kosli-pipeline>Creating a Kosli pipeline
<a class=anchor href=#creating-a-kosli-pipeline>#</a></h2><p>To follow the examples make sure you have followed the instructions in Local setup.</p><p>Create a Kosli pipeline where you can report what software your CI system
is building. You are building two applications, so make
two Kosli pipelines <code>web-server</code> and <code>database-server</code>.</p><p>Create your new pipelines:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline declare <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline web-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;pipeline to build web-server&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --visibility private <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --template artifact
</span></span></code></pre></div><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline declare <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline database-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;pipeline to build database-server&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --visibility private <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --template artifact
</span></span></code></pre></div><p>You can immediately verify that the Kosli pipelines were created:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline ls
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>NAME             DESCRIPTION                        VISIBILITY
</span></span><span style=display:flex><span>database-server  pipeline to build database-server  private
</span></span><span style=display:flex><span>web-server       pipeline to build web-server       private
</span></span></code></pre></div><p>In the web interface you can select the <strong>Pipelines</strong> menu on the left.
It will show you that you have a <em>web-server</em> and <em>database-server</em> pipeline.
If you select either of the pipelines they will show that no artifacts have
been reported for the pipelines.</p><h2 id=building-artifacts-and-reporting-them-to-kosli>Building artifacts and reporting them to Kosli
<a class=anchor href=#building-artifacts-and-reporting-them-to-kosli>#</a></h2><p>Simulate building your software:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>simulate_build
</span></span></code></pre></div><p>Report that you have built the web and database applications. You are using
a dummy <code>--build-url</code>, but in reality it would be a CI build URL:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline artifact report creation /tmp/try-kosli/build/web_<span style=color:#66d9ef>$(</span>cat /tmp/try-kosli/code/web.src<span style=color:#66d9ef>)</span>.bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline web-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --artifact-type file <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --build-url file://dummy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --commit-url file:///tmp/try-kosli/code <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --repo-root /tmp/try-kosli/code <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --git-commit <span style=color:#66d9ef>$(</span>cd /tmp/try-kosli/code; git rev-parse HEAD<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline artifact report creation /tmp/try-kosli/build/db_<span style=color:#66d9ef>$(</span>cat /tmp/try-kosli/code/db.src<span style=color:#66d9ef>)</span>.bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline database-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --artifact-type file <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --build-url file://dummy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --commit-url file:///tmp/try-kosli/code <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --repo-root /tmp/try-kosli/code <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --git-commit <span style=color:#66d9ef>$(</span>cd /tmp/try-kosli/code; git rev-parse HEAD<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>You can see you have built one artifact in your <em>web-server</em> pipeline:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli artifact ls web-server
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>COMMIT   ARTIFACT                                                                       STATE      CREATED_AT
</span></span><span style=display:flex><span>5187374  Name: web_2.bin                                                                COMPLIANT  16 Aug 22 08:00 CEST
</span></span><span style=display:flex><span>         Fingerprint: cbc92ce1291830382ec23b95efc213d6e1725b5157bcb2927d48296b61c86746             
</span></span></code></pre></div><p>And one for the <em>database-server</em> pipeline:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli artifact ls database-server
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>COMMIT   ARTIFACT                                                                        STATE      CREATED_AT
</span></span><span style=display:flex><span>5187374  Name: db_1.bin                                                                  COMPLIANT  16 Aug 22 08:01 CEST
</span></span><span style=display:flex><span>         Fingerprint: 0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af             
</span></span></code></pre></div><p>You can also get detailed information about each artifact that has been reported:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli artifact get database-server@0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Name:         db_1.bin
</span></span><span style=display:flex><span>State:        COMPLIANT
</span></span><span style=display:flex><span>Git commit:   518737485e5150ee6255a1c74749997d380c1708
</span></span><span style=display:flex><span>Build URL:    file://dummy
</span></span><span style=display:flex><span>Commit URL:   file:///tmp/try-kosli/code
</span></span><span style=display:flex><span>Created at:   16 Aug 22 08:01 CEST • 2 hours ago
</span></span><span style=display:flex><span>Approvals:    None
</span></span><span style=display:flex><span>Deployments:  None
</span></span><span style=display:flex><span>Evidence:
</span></span></code></pre></div><p>In the web interface you can select the <em>database-server</em> pipeline and then the <em>db_1.bin</em>
artifact to get more details.</p><h1 id=deployments>Deployments
<a class=anchor href=#deployments>#</a></h1><p>A Kosli deployment command is used to indicate an artifact is
being deployed to a given runtime environment.</p><h2 id=deploying-software-to-the-server-and-reporting-the-deployment-to-kosli>Deploying software to the server and reporting the deployment to Kosli
<a class=anchor href=#deploying-software-to-the-server-and-reporting-the-deployment-to-kosli>#</a></h2><p>Report to Kosli that the web software is expected to be deployed:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli expect deployment /tmp/try-kosli/build/web_<span style=color:#66d9ef>$(</span>cat /tmp/try-kosli/code/web.src<span style=color:#66d9ef>)</span>.bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline web-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --artifact-type file <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --build-url file://dummy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --environment production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;Web server version </span><span style=color:#66d9ef>$(</span>cat /tmp/try-kosli/code/web.src<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>Simulate deploying your software to the server:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>simulate_deployment
</span></span></code></pre></div><p>You can verify the deployment with:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli deployment ls web-server
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>ID   ARTIFACT                                                                        ENVIRONMENT  REPORTED_AT
</span></span><span style=display:flex><span>1    Name: web_2.bin                                                                 production   16 Aug 22 08:02 CEST
</span></span><span style=display:flex><span>     Fingerprint: cbc92ce1291830382ec23b95efc213d6e1725b5157bcb2927d48296b61c86746               
</span></span></code></pre></div><p>Get detailed information about a deployment:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli deployment get web-server#1
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>ID:                    1
</span></span><span style=display:flex><span>Artifact fingerprint:  cbc92ce1291830382ec23b95efc213d6e1725b5157bcb2927d48296b61c86746
</span></span><span style=display:flex><span>Artifact name:         web_2.bin
</span></span><span style=display:flex><span>Build URL:             file://dummy
</span></span><span style=display:flex><span>Created at:            16 Aug 22 08:02 CEST • 32 seconds ago
</span></span><span style=display:flex><span>Environment:           production
</span></span><span style=display:flex><span>Runtime state:         The artifact running since 16 Aug 22 07:58 CEST
</span></span></code></pre></div><p>If you select the <em>web_2.bin</em> artifact in the web interface it will show
that it was part of Deployment #1 to <em>production</em> environment.</p><h3 id=see-also-the-other-tutorials>See also the other tutorials:
<a class=anchor href=#see-also-the-other-tutorials>#</a></h3><ul><li><a href=../following_a_git_commit_to_runtime_environments/>Following a git commit to runtime environments</a></li><li><a href=../tracing_a_production_incident_back_to_git_commits/>Tracing a production incident back to git commits</a></li></ul><ul class=contents></ul></article><aside class=book-toc><div class=book-toc-content><h4 class=toc-title>On this page:</h4><nav id=TableOfContents><ul><li><a href=#preparing-the-tutorial>Preparing the tutorial</a></li><li><a href=#environment>Environment</a><ul><li><a href=#creating-a-kosli-environment>Creating a Kosli environment</a></li><li><a href=#reporting-the-software-running-in-your-environment>Reporting the software running in your environment</a></li></ul></li><li><a href=#pipelines>Pipelines</a><ul><li><a href=#creating-a-kosli-pipeline>Creating a Kosli pipeline</a></li><li><a href=#building-artifacts-and-reporting-them-to-kosli>Building artifacts and reporting them to Kosli</a></li></ul></li><li><a href=#deployments>Deployments</a><ul><li><a href=#deploying-software-to-the-server-and-reporting-the-deployment-to-kosli>Deploying software to the server and reporting the deployment to Kosli</a></li></ul></li></ul></nav></div></aside></div><footer class=book-footer><hr><div class=footer-grid><div><h3 class=h5-style>Get started for FREE!<br>Sign up GitHub.<br>Easy!</h3><a class="btn btn-main" href=https://app.kosli.com target=_blank>Sign up</a></div><div><h3 class=h5-style>Share your feedback on the docs so we can make them easier for you to use</h3><a href=https://www.kosli.com/community/ target=_blank class="btn btn-secondary">Join the Slack Community</a></div><div><h3 class=h5-style>Stuck with something?</h3><p>We have an open Slack channel where you can get in touch with the Kosli team and other users.</p><p><a href=https://www.kosli.com/community/ target=_blank>Ask the Kosli Slack community</a></p><p><a href=mailto:info@kosli.com>Email support</a></p></div></div><hr><div class="secondary-footer flex align-center flex-wrap" style=gap:40px><div><img src=/images/kosli-logo.svg alt="Kosli Logo"></div><div>© 2022 Kosli Inc.</div><div><a href=https://www.kosli.com target=_blank>kosli.com</a></div><div><a href=https://www.kosli.com/privacy-policy/ target=_blank>Privacy</a></div><div><a href=https://www.kosli.com/contact/ target=_blank>Contact Kosli</a></div><div><a href=https://www.kosli.com/pricing/ target=_blank>Pricing</a></div><div><a href=https://www.kosli.com/blog/ target=_blank>Blog</a></div><div><a href=https://www.kosli.com/about/ target=_blank>About</a></div></div><script>(function(){document.querySelectorAll("div.command").forEach(e=>{let t=document.createElement("div"),n=document.createTextNode("copied!");t.appendChild(n),e.appendChild(t),t.classList.add("copiedText"),e.addEventListener("click",function(){if(navigator.clipboard){let n=e.querySelector("code");navigator.clipboard.writeText(n.textContent),t.classList.add("visible"),setTimeout(()=>{t.classList.remove("visible")},1500)}})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main><div class=top-header><div class="container flex"><div class=docs-logo><a href=/><img src=/kosli-docs-logo-white.svg alt="Kosli docs logo"></a></div><div class=separator></div></div></div></body></html>