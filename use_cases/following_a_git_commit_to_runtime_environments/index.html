<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Following a git commit to runtime environments # Overview # In this 5 minute tutorial you'll learn how Kosli tracks &#34;life after git&#34; and shows you events from:
CI-pipelines (eg, building the docker image, running the unit tests, deploying, etc) runtime environments (eg, the blue-green rollover, instance scaling, etc) You'll follow an actual git commit to an open-source project called cyber-dojo. In our example cyber-dojo’s runner service should run with three replicas."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Following a git commit to runtime environments"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://docs.kosli.com/use_cases/following_a_git_commit_to_runtime_environments/"><title>Following a git commit to runtime environments | Kosli developer documentation</title><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=stylesheet href=/book.min.c5f8a19643c6764113dc90f2dcf254a8aa166f772dc327424e7d84de5c9f2be5.css integrity="sha256-xfihlkPGdkET3JDy3PJUqKoWb3ctwydCTn2E3lyfK+U=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.f672fab9c600e551a3552f652aff3c89f17b367ac4f578b38370ac3888895237.js integrity="sha256-9nL6ucYA5VGjVS9lKv88ifF7NnrE9Xizg3CsOIiJUjc=" crossorigin=anonymous></script>
<script src=https://cdn.usefathom.com/script.js data-site=AUFUAQWT data-excluded-domains=localhost defer></script>
<link rel=alternate type=application/rss+xml href=https://docs.kosli.com/use_cases/following_a_git_commit_to_runtime_environments/index.xml title="Kosli developer documentation"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Kosli developer documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-8d07877860004719ef46751318e056d1 class=toggle>
<label for=section-8d07877860004719ef46751318e056d1 class="flex justify-between"><a href=https://docs.kosli.com/introducing_kosli/>Introducing Kosli</a></label><ul><li><a href=https://docs.kosli.com/introducing_kosli/organizations/>Organizations</a></li><li><a href=https://docs.kosli.com/introducing_kosli/environments/>Environments</a></li><li><a href=https://docs.kosli.com/introducing_kosli/pipelines/>Pipelines</a></li><li><a href=https://docs.kosli.com/introducing_kosli/fingerprint/>Fingerprint</a></li><li><a href=https://docs.kosli.com/introducing_kosli/cli/>CLI</a></li><li><a href=https://docs.kosli.com/introducing_kosli/web_ui/>Web UI</a></li></ul></li><li><input type=checkbox id=section-acdc30ff5cf57e4ff3a5b04fe43650db class=toggle>
<label for=section-acdc30ff5cf57e4ff3a5b04fe43650db class="flex justify-between"><a href=https://docs.kosli.com/getting_started/>Getting started</a></label><ul><li><a href=https://docs.kosli.com/getting_started/getting_started_with_kosli/>Getting started with Kosli</a></li><li><a href=https://docs.kosli.com/getting_started/installation/>Install Kosli</a></li><li><a href=https://docs.kosli.com/getting_started/use_kosli_in_ci_systems/>Use Kosli in CI Systems</a></li></ul></li><li><input type=checkbox id=section-fdba2124b9f6bc01f478608f07a6e592 class=toggle checked>
<label for=section-fdba2124b9f6bc01f478608f07a6e592 class="flex justify-between"><a href=https://docs.kosli.com/use_cases/>Use cases</a></label><ul><li><a href=https://docs.kosli.com/use_cases/following_a_git_commit_to_runtime_environments/ class=active>Following a git commit to runtime environments</a><ul></ul></li><li><a href=https://docs.kosli.com/use_cases/tracing_a_production_incident_back_to_git_commits/>Tracing a production incident back to git commits</a><ul></ul></li><li><a href=https://docs.kosli.com/use_cases/simulating_a_devops_system/>Simulating a DevOps system</a><ul></ul></li></ul></li><li><input type=checkbox id=section-23c01066495116db89ec68655dfc73ed class=toggle>
<label for=section-23c01066495116db89ec68655dfc73ed class="flex justify-between"><a href=https://docs.kosli.com/how_to/>How to</a></label><ul><li><a href=https://docs.kosli.com/how_to/record/>Record</a></li><li><a href=https://docs.kosli.com/how_to/connect/>Connect</a></li><li><a href=https://docs.kosli.com/how_to/search/>Search</a></li></ul></li><li><input type=checkbox id=section-3993beb65ef7e76a7dbe6e66c07255ac class=toggle>
<label for=section-3993beb65ef7e76a7dbe6e66c07255ac class="flex justify-between"><a href=https://docs.kosli.com/client_reference/>Reference</a></label><ul><li><a href=https://docs.kosli.com/client_reference/kosli/>kosli</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_get/>kosli approval get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_ls/>kosli approval ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_get/>kosli artifact get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_ls/>kosli artifact ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_artifact/>kosli assert artifact</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_bitbucket-pullrequest/>kosli assert bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_environment/>kosli assert environment</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_github-pullrequest/>kosli assert github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_status/>kosli assert status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_get/>kosli deployment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_ls/>kosli deployment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_allowedartifacts_add/>kosli environment allowedartifacts add</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_declare/>kosli environment declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_diff/>kosli environment diff</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_get/>kosli environment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_inspect/>kosli environment inspect</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_log/>kosli environment log</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_ls/>kosli environment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_docker/>kosli environment report docker</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_ecs/>kosli environment report ecs</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_k8s/>kosli environment report k8s</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_lambda/>kosli environment report lambda</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_s3/>kosli environment report s3</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_server/>kosli environment report server</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_expect_deployment/>kosli expect deployment</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_fingerprint/>kosli fingerprint</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_assert/>kosli pipeline approval assert</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_report/>kosli pipeline approval report</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_request/>kosli pipeline approval request</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_creation/>kosli pipeline artifact report creation</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_bitbucket-pullrequest/>kosli pipeline artifact report evidence bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_generic/>kosli pipeline artifact report evidence generic</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_github-pullrequest/>kosli pipeline artifact report evidence github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_test/>kosli pipeline artifact report evidence test</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_declare/>kosli pipeline declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_inspect/>kosli pipeline inspect</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_ls/>kosli pipeline ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_status/>kosli status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_version/>kosli version</a></li></ul></li><li><input type=checkbox id=section-d06928ff9c11121b26f141ced850796c class=toggle>
<label for=section-d06928ff9c11121b26f141ced850796c class="flex justify-between"><a href=https://docs.kosli.com/helm/>Helm</a></label><ul><li><a href=https://docs.kosli.com/helm/helm_chart/>Helm Chart</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Following a git commit to runtime environments</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#following-a-git-commit-to-runtime-environments>Following a git commit to runtime environments</a><ul><li><a href=#overview>Overview</a></li><li><a href=#getting-ready>Getting ready</a></li><li><a href=#pipeline-events>Pipeline events</a></li><li><a href=#environment-snapshots>Environment Snapshots</a></li><li><a href=#diffing-snapshots>Diffing snapshots</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=following-a-git-commit-to-runtime-environments>Following a git commit to runtime environments
<a class=anchor href=#following-a-git-commit-to-runtime-environments>#</a></h1><h2 id=overview>Overview
<a class=anchor href=#overview>#</a></h2><p>In this 5 minute tutorial you'll learn how Kosli tracks "life after git" and shows you events from:</p><ul><li>CI-pipelines (eg, building the docker image, running the unit tests, deploying, etc)</li><li>runtime environments (eg, the blue-green rollover, instance scaling, etc)</li></ul><p>You'll follow an actual git commit to an open-source project called <strong>cyber-dojo</strong>.
In our example cyber-dojo’s <code>runner</code> service should run with three replicas. However, due an oversight while switching
from Google Kubernetes Engine (GKE) to AWS Elastic Container Service (ECS), it was running with just one replica.
You will follow the commit that fixed this.</p><h2 id=getting-ready>Getting ready
<a class=anchor href=#getting-ready>#</a></h2><p>You need to:</p><ul><li><a href=/getting_started/installation/>Install the <code>kosli</code> CLI
</a>.</li><li><a href=/getting_started/installation#getting-your-kosli-api-token>Get your Kosli API token
</a>.</li><li><a href=/getting_started/installation#set-the-kosli_api_token-environment-variable>Set the KOSLI_API_TOKEN environment variable
</a>.</li><li>Set the KOSLI_OWNER environment variable to <code>cyber-dojo</code> (the Kosli <code>cyber-dojo</code> organization is public so any authenticated user can read its data):<div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export KOSLI_OWNER<span style=color:#f92672>=</span>cyber-dojo
</span></span></code></pre></div></li></ul><h2 id=pipeline-events>Pipeline events
<a class=anchor href=#pipeline-events>#</a></h2><h3 id=listing-pipelines>Listing pipelines
<a class=anchor href=#listing-pipelines>#</a></h3><p>Find out which <code>cyber-dojo</code> repositories have a CI pipeline reporting to <a href=https://app.kosli.com target=_blank>Kosli
</a>:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline ls
</span></span></code></pre></div><p>You will see:</p><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>NAME                    DESCRIPTION                         VISIBILITY
</span></span><span style=display:flex><span>creator                 UX for Group/Kata creation          public
</span></span><span style=display:flex><span>custom-start-points     Custom exercises choices            public
</span></span><span style=display:flex><span>dashboard               UX for a group practice dashboard   public
</span></span><span style=display:flex><span>differ                  Diff files from two traffic-lights  public
</span></span><span style=display:flex><span>exercises-start-points  Exercises choices                   public
</span></span><span style=display:flex><span>languages-start-points  Language+TestFramework choices      public
</span></span><span style=display:flex><span>nginx                   Reverse proxy                       public
</span></span><span style=display:flex><span>repler                  REPL for Python images              public
</span></span><span style=display:flex><span>runner                  Test runner                         public
</span></span><span style=display:flex><span>saver                   Group/Kata model+persistence        public
</span></span><span style=display:flex><span>shas                    UX for git+image shas               public
</span></span><span style=display:flex><span>web                     UX for practicing TDD               public
</span></span></code></pre></div><blockquote class="book-hint info"><h2 id=cyber-dojo-overview>cyber-dojo overview
<a class=anchor href=#cyber-dojo-overview>#</a></h2><ul><li><a href=https://cyber-dojo.org target=_blank>cyber-dojo</a> is a web platform where teams
practice TDD without any installation.</li><li>cyber-dojo has a microservice architecture with a dozen git repositories.</li><li>Each git repository has its own Github Actions CI pipeline producing a docker image.</li><li>These docker images run in two AWS environments named
<a href=https://app.kosli.com/cyber-dojo/environments/aws-beta target=_blank>aws-beta</a>
and <a href=https://app.kosli.com/cyber-dojo/environments/aws-prod target=_blank>aws-prod
</a>.</li></ul></blockquote><h3 id=following-the-artifact>Following the artifact
<a class=anchor href=#following-the-artifact>#</a></h3><p>The runner service, only had one instance running instead of three.
The commit which fixed the problem was
<a href=https://github.com/cyber-dojo/runner/commit/16d9990ad23a40eecaf087abac2a58a2d2a4b3f4 target=_blank>16d9990</a>
in the <code>runner</code> repository. Follow this commit using the <code>kosli</code> command:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli artifact get runner:16d9990
</span></span></code></pre></div><p>You will see:</p><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Name:         cyberdojo/runner:16d9990
</span></span><span style=display:flex><span>Fingerprint:  9af401c4350b21e3f1df17d6ad808da43d9646e75b6da902cc7c492bcfb9c625
</span></span><span style=display:flex><span>Created on:   Mon, 22 Aug 2022 11:35:00 CEST • 15 days ago
</span></span><span style=display:flex><span>Git commit:   16d9990ad23a40eecaf087abac2a58a2d2a4b3f4
</span></span><span style=display:flex><span>Commit URL:   https://github.com/cyber-dojo/runner/commit/16d9990ad23a40eecaf087abac2a58a2d2a4b3f4
</span></span><span style=display:flex><span>Build URL:    https://github.com/cyber-dojo/runner/actions/runs/2902808452
</span></span><span style=display:flex><span>State:        COMPLIANT
</span></span><span style=display:flex><span>History:
</span></span><span style=display:flex><span>    Artifact created                                     Mon, 22 Aug 2022 11:35:00 CEST
</span></span><span style=display:flex><span>    branch-coverage evidence received                    Mon, 22 Aug 2022 11:36:02 CEST
</span></span><span style=display:flex><span>    Deployment #18 to aws-beta environment               Mon, 22 Aug 2022 11:37:17 CEST
</span></span><span style=display:flex><span>    Deployment #19 to aws-prod environment               Mon, 22 Aug 2022 11:38:21 CEST
</span></span><span style=display:flex><span>    Started running in aws-beta#84 environment           Mon, 22 Aug 2022 11:38:28 CEST
</span></span><span style=display:flex><span>    Started running in aws-prod#65 environment           Mon, 22 Aug 2022 11:39:22 CEST
</span></span><span style=display:flex><span>    Scaled down from 3 to 2 in aws-beta#117 environment  Wed, 24 Aug 2022 18:03:42 CEST
</span></span><span style=display:flex><span>    No longer running in aws-beta#119 environment        Wed, 24 Aug 2022 18:05:42 CEST
</span></span><span style=display:flex><span>    Scaled down from 3 to 1 in aws-prod#94 environment   Wed, 24 Aug 2022 18:10:28 CEST
</span></span><span style=display:flex><span>    No longer running in aws-prod#96 environment         Wed, 24 Aug 2022 18:12:28 CEST
</span></span></code></pre></div><p>Let's look at this output in detail:</p><ul><li><strong>Name</strong>: The name of the docker image is <code>cyberdojo/runner:16d9990</code>. Its image registry is defaulted to
<code>dockerhub</code>. Its :tag is the short-sha of the git commit.</li><li><strong>Fingerprint</strong>: The unique tamper-proof SHA256 fingerprint of the artifact.</li><li><strong>Created on</strong>: The artifact was created on 22nd August 2022, at 11:35 CEST.</li><li><strong>Commit URL</strong>: You can follow <a href=https://github.com/cyber-dojo/runner/commit/16d9990ad23a40eecaf087abac2a58a2d2a4b3f4 target=_blank>the commit URL</a>
to the actual commit on Github since cyber-dojo's git repositories are public.</li><li><strong>Build URL</strong>: You can follow <a href=https://github.com/cyber-dojo/runner/actions/runs/2902808452 target=_blank>the build URL</a>
to the actual Github Action for this commit.</li><li><strong>State</strong>: COMPLIANT means that all the promised evidence for the artifact (in this case <code>branch-coverage</code>)
was provided before deployment.</li><li><strong>History</strong>:<ul><li><strong>CI pipeline events</strong><ul><li>The artifact was <strong>created</strong> on the 22nd August at 11:35:00 CEST.</li><li>The artifact has <code>branch-coverage</code> <strong>evidence</strong>.</li><li>The artifact was <strong>deployed</strong> to <a href=https://app.merkely.com/cyber-dojo/pipelines/runner/deployments/18 target=_blank>aws-beta</a> on 22nd August 11:37:17 CEST, and to <a href=https://app.merkely.com/cyber-dojo/pipelines/runner/deployments/19 target=_blank>aws-prod</a>
a minute later.</li></ul></li><li><strong>Runtime environment events</strong><ul><li>The artifact was reported <strong>running</strong> in both environments.</li><li>The artifact's number of running instances <strong>scaled down</strong>.</li><li>The artifact was reported <strong>exited</strong>.</li></ul></li></ul></li></ul><p>The information about this artifact is also available through the <a href=https://app.merkely.com/cyber-dojo/pipelines/runner/artifacts/9af401c4350b21e3f1df17d6ad808da43d9646e75b6da902cc7c492bcfb9c625 target=_blank>web interface
</a>.</p><blockquote class="book-hint info">The <code>runner</code> service uses <a href=https://en.wikipedia.org/wiki/Continuous_deployment target=_blank>Continuous Deployment
</a>;
if the tests pass the artifact is <a href=https://en.wikipedia.org/wiki/Blue-green_deployment target=_blank>blue-green deployed</a>
to both its runtime environments <em>without</em> any manual approval steps.
Some cyber-dojo services (eg web) have a manual approval step, and Kosli supports this.</blockquote><h2 id=environment-snapshots>Environment Snapshots
<a class=anchor href=#environment-snapshots>#</a></h2><p>Kosli environments store information about what is running in your actual runtime environments (eg server, Kubernetes cluster, AWS, ...).
We use one Kosli environment per runtime environment.</p><p>The Kosli CLI periodically fingerprints all the running artifacts in a runtime environment and reports them to Kosli.
Whenever a change is detected, a snapshot of the environment is saved.</p><blockquote class="book-hint info">Cyber-dojo runs the <code>kosli</code> CLI from inside its AWS runtime environments
using a <a href=https://github.com/cyber-dojo/merkely-environment-reporter/tree/main/deployment/terraform/lambda-reporter target=_blank>lambda function</a>
to report the running services to Kosli.</blockquote><p>The <strong>History</strong> of the artifact tells you your artifact started running in snapshot #65 of <code>aws-prod</code>.</p><p>You query Kosli to see what was running in <code>aws-prod</code> snapshot #65:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli env get aws-prod#65
</span></span></code></pre></div><p>The output will be:</p><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>COMMIT   ARTIFACT                                                                         PIPELINE   RUNNING_SINCE  REPLICAS
</span></span><span style=display:flex><span>16d9990  Name: 274425519734.dkr.ecr.eu-central-1.amazonaws.com/runner:16d9990             runner     11 days ago    3
</span></span><span style=display:flex><span>         Fingerprint: 9af401c4350b21e3f1df17d6ad808da43d9646e75b6da902cc7c492bcfb9c625                              
</span></span><span style=display:flex><span>                                                                                                    
</span></span><span style=display:flex><span>7c45272  Name: 274425519734.dkr.ecr.eu-central-1.amazonaws.com/shas:7c45272               shas       11 days ago    1
</span></span><span style=display:flex><span>         Fingerprint: 76c442c04283c4ca1af22d882750eb960cf53c0aa041bbdb2db9df2f2c1282be                              
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...some output elided...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>85d83c6  Name: 274425519734.dkr.ecr.eu-central-1.amazonaws.com/runner:85d83c6             runner     13 days ago    1
</span></span><span style=display:flex><span>         Fingerprint: eeb0cfc9ee7f69fbd9531d5b8c1e8d22a8de119e2a422344a714a868e9a8bfec                              
</span></span><span style=display:flex><span>                                                                                                  
</span></span><span style=display:flex><span>1a2b170  Name: 274425519734.dkr.ecr.eu-central-1.amazonaws.com/differ:1a2b170             differ     13 days ago    1
</span></span><span style=display:flex><span>         Fingerprint: d8440b94f7f9174c180324ceafd4148360d9d7c916be2b910f132c58b8a943ae                              
</span></span></code></pre></div><p>You see in this snapshot, the <code>runner:16d9990</code> artifact is indeed running with 3 replicas.
You have proof the git commit has worked.</p><blockquote class="book-hint info"><h2 id=blue-green-deployment>Blue-green deployment
<a class=anchor href=#blue-green-deployment>#</a></h2><p>There were <em>two</em> versions of <code>runner</code> at this point in time!
The first had three replicas (to fix the problem), but there was also a second (from commit <code>85d83c6</code>) with only one replica.</p><p>You are seeing a <strong>blue-green deployment</strong> happening;
<code>runner:85d83c6</code> is about to be stopped and will not be reported in
snapshot <code>aws-prod#66</code>.</p></blockquote><h2 id=diffing-snapshots>Diffing snapshots
<a class=anchor href=#diffing-snapshots>#</a></h2><p>Kosli's <code>env diff</code> command allows you to see differences between two versions of your
runtime environment.</p><p>Let's find out what's <em>different</em> between the <code>aws-prod#64</code> and <code>aws-prod#65</code> snapshots:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli env diff aws-prod#64 aws-prod#65
</span></span></code></pre></div><p>The response will be:</p><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Only present in aws-prod#65
</span></span><span style=display:flex><span>                   
</span></span><span style=display:flex><span>     Name:         274425519734.dkr.ecr.eu-central-1.amazonaws.com/runner:16d9990
</span></span><span style=display:flex><span>     Fingerprint:  9af401c4350b21e3f1df17d6ad808da43d9646e75b6da902cc7c492bcfb9c625
</span></span><span style=display:flex><span>     Pipeline:     runner
</span></span><span style=display:flex><span>     Commit URL:   https://github.com/cyber-dojo/runner/commit/16d9990ad23a40eecaf087abac2a58a2d2a4b3f4
</span></span><span style=display:flex><span>     Started:      Mon, 22 Aug 2022 11:39:17 CEST • 15 days ago
</span></span></code></pre></div><p>The output above shows that <code>runner:16d9990</code> started running in snapshot 65 of <code>aws-prod</code> environment.</p><p>You have seen how Kosli can follow a git commit on its way into production,
and provide information about the artifacts history, without any access to cyber-dojo's <code>aws-prod</code> environment.</p><h3 id=see-also-the-other-tutorials>See also the other tutorials:
<a class=anchor href=#see-also-the-other-tutorials>#</a></h3><ul><li><a href=../tracing_a_production_incident_back_to_git_commits/>Tracing a production incident back to git commits</a></li><li><a href=../simulating_a_devops_system/>Simulating a DevOps system</a></li></ul><ul class=contents></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){document.querySelectorAll("div.command").forEach(e=>{let t=document.createElement("div"),n=document.createTextNode("copied!");t.appendChild(n),e.appendChild(t),t.classList.add("copiedText"),e.addEventListener("click",function(){if(navigator.clipboard){let n=e.querySelector("code");navigator.clipboard.writeText(n.innerText),t.classList.add("visible"),setTimeout(()=>{t.classList.remove("visible")},1500)}})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#following-a-git-commit-to-runtime-environments>Following a git commit to runtime environments</a><ul><li><a href=#overview>Overview</a></li><li><a href=#getting-ready>Getting ready</a></li><li><a href=#pipeline-events>Pipeline events</a></li><li><a href=#environment-snapshots>Environment Snapshots</a></li><li><a href=#diffing-snapshots>Diffing snapshots</a></li></ul></li></ul></nav></div></aside></main><div class=top-header><div class="container flex"><div class=docs-logo><a href=/><img src=/kosli-docs-logo-white.svg alt="Kosli docs logo"></a></div><div class=separator></div></div></div></body></html>