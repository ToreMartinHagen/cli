<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Report Artifact # Every time you build an artifact - in our case a Docker image - you can store (and easily access) all the information you have about it in Kosli. We call it reporting an artifact.
Artifacts in Kosli are reported to Kosli Pipelines. You can find the Pipelines section just below Environments.
Create a pipeline # To report an artifact from your GitHub workflow you need to create a Kosli pipeline first."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Report Artifact"><meta property="og:description" content="Report Artifact # Every time you build an artifact - in our case a Docker image - you can store (and easily access) all the information you have about it in Kosli. We call it reporting an artifact.
Artifacts in Kosli are reported to Kosli Pipelines. You can find the Pipelines section just below Environments.
Create a pipeline # To report an artifact from your GitHub workflow you need to create a Kosli pipeline first."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.kosli.com/tutorials/github_actions_and_k8s/report_artifact/"><meta property="article:section" content="tutorials"><title>Report Artifact | Kosli developer documentation</title><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=stylesheet href=/book.min.3af8d44a415c6d1a20c60c2d260c084cfd70374a4c67693c756f0a73ad46388b.css integrity="sha256-OvjUSkFcbRogxgwtJgwITP1wN0pMZ2k8dW8Kc61GOIs=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.530a257995c67a935ea95a6ad7695ede18f23ffe4b988deebe7f6b95aeb61ff1.js integrity="sha256-UwoleZXGepNeqVpq12le3hjyP/5LmI3uvn9rla62H/E=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Kosli developer documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-88ce4fcfc81f5fbcc629e032a4440ec3 class=toggle>
<label for=section-88ce4fcfc81f5fbcc629e032a4440ec3 class="flex justify-between"><a href=https://docs.kosli.com/getting_familiar_with_kosli/>Getting Familiar with Kosli</a></label><ul><li><a href=https://docs.kosli.com/getting_familiar_with_kosli/installation/>Installing Kosli CLI</a><ul></ul></li><li><a href=https://docs.kosli.com/getting_familiar_with_kosli/simulating_a_devops_system/>Simulating a DevOps system</a><ul></ul></li></ul></li><li><input type=checkbox id=section-90d1aeee0e96e115d1edea3b994d19fb class=toggle checked>
<label for=section-90d1aeee0e96e115d1edea3b994d19fb class="flex justify-between"><a href=https://docs.kosli.com/tutorials/>Tutorials</a></label><ul><li><input type=checkbox id=section-7eca5fc2ae3a7a6d5837431d0a2728d1 class=toggle checked>
<label for=section-7eca5fc2ae3a7a6d5837431d0a2728d1 class="flex justify-between"><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/>GitHub Actions and k8s</a></label><ul><li><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/prerequisites/>Prerequisites</a></li><li><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/report_environment/>Report Environment</a></li><li><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/report_artifact/ class=active>Report Artifact</a></li><li><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/report_deployment/>Report Deployment</a></li></ul></li></ul></li><li><input type=checkbox id=section-dc8a1c63e6da60163016ce21cae1faa0 class=toggle>
<label for=section-dc8a1c63e6da60163016ce21cae1faa0 class="flex justify-between"><a href=https://docs.kosli.com/concepts/>Concepts</a></label><ul><li><a href=https://docs.kosli.com/concepts/environments/>Environments</a></li><li><a href=https://docs.kosli.com/concepts/pipelines/>Pipelines</a></li></ul></li><li><input type=checkbox id=section-3993beb65ef7e76a7dbe6e66c07255ac class=toggle>
<label for=section-3993beb65ef7e76a7dbe6e66c07255ac class="flex justify-between"><a href=https://docs.kosli.com/client_reference/>Kosli Commands</a></label><ul><li><a href=https://docs.kosli.com/client_reference/kosli/>kosli</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_get/>kosli approval get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_ls/>kosli approval ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_get/>kosli artifact get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_ls/>kosli artifact ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_artifact/>kosli assert artifact</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_bitbucket-pullrequest/>kosli assert bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_github-pullrequest/>kosli assert github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_status/>kosli assert status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_get/>kosli deployment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_ls/>kosli deployment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_allowedartifacts_add/>kosli environment allowedartifacts add</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_declare/>kosli environment declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_diff/>kosli environment diff</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_get/>kosli environment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_log/>kosli environment log</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_ls/>kosli environment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_ecs/>kosli environment report ecs</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_k8s/>kosli environment report k8s</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_lambda/>kosli environment report lambda</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_s3/>kosli environment report s3</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_server/>kosli environment report server</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_fingerprint/>kosli fingerprint</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_assert/>kosli pipeline approval assert</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_report/>kosli pipeline approval report</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_request/>kosli pipeline approval request</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_creation/>kosli pipeline artifact report creation</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_bitbucket-pullrequest/>kosli pipeline artifact report evidence bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_generic/>kosli pipeline artifact report evidence generic</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_github-pullrequest/>kosli pipeline artifact report evidence github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_test/>kosli pipeline artifact report evidence test</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_declare/>kosli pipeline declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_deployment_report/>kosli pipeline deployment report</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_get/>kosli pipeline get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_ls/>kosli pipeline ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_snapshot_get/>kosli snapshot get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_snapshot_ls/>kosli snapshot ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_status/>kosli status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_version/>kosli version</a></li></ul></li><li><input type=checkbox id=section-d06928ff9c11121b26f141ced850796c class=toggle>
<label for=section-d06928ff9c11121b26f141ced850796c class="flex justify-between"><a href=https://docs.kosli.com/helm/>Helm</a></label><ul><li><a href=https://docs.kosli.com/helm/helm_chart/>Helm Chart</a></li></ul></li><li><a href=https://docs.kosli.com/ci-defaults/>Defaulted command flags from CI</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Report Artifact</strong>
<label for=toc-control></label></div></header><article class=markdown><h1 id=report-artifact>Report Artifact
<a class=anchor href=#report-artifact>#</a></h1><p>Every time you build an <strong>artifact</strong> - in our case a Docker image - you can store (and easily access) all the information you have about it in Kosli. We call it <em>reporting an <strong>artifact</strong></em>.</p><p>Artifacts in Kosli are reported to Kosli <strong>Pipelines</strong>. You can find the <strong>Pipelines</strong> section just below <strong>Environments</strong>.</p><h2 id=create-a-pipeline>Create a pipeline
<a class=anchor href=#create-a-pipeline>#</a></h2><p>To report an <strong>artifact</strong> from your GitHub workflow you need to create a Kosli <strong>pipeline</strong> first. Every time your workflow builds a new version of Docker image it will be reported to the same Kosli <strong>pipeline</strong>.
Kosli <strong>pipeline</strong> has to exist before you can start reporting <strong>artifacts</strong> to it, and you can make the creation of a <strong>pipeline</strong> a part of the build workflow. (It's safe - rerunning <strong>pipeline</strong> creation command won't erase existing entries.)
In this guide we're creating a Kosli <strong>pipeline</strong> called <strong>github-k8s-demo</strong> and that's the name you'll see in the code.</p><p>As it was in the case of reporting environment, we need to download Kosli CLI in the workflow, to be able to run the commands.</p><h2 id=report-an-artifact>Report an artifact
<a class=anchor href=#report-an-artifact>#</a></h2><p>Here is a complete workflow that takes care of CLI download, <strong>pipeline</strong> creation and docker image build and reports it to the Kosli <strong>pipeline</strong>.</p><p>Remember:</p><ul><li><code>K8S_CLUSTER_NAME</code>, <code>K8S_GCP_ZONE</code> and <code>NAMESPACE</code> should be the same you used in <strong>Report Environment</strong> step</li><li><code>IMAGE</code> should contain your dockerhub username (instead of our colleague's Ewelina username). You also need to use the correct username in <em>Login to hub.docker.com</em> step</li><li><code>KOSLI_OWNER</code> should be the same your Kosli username.</li></ul><p>In the workflow you'll find comments about specific parts of it.</p><pre tabindex=0><code>name: Build and Deploy

on:
  push:


env:
  # gke k8s cluster variables
  K8S_CLUSTER_NAME: kosli-dev
  K8S_GCP_ZONE: europe-west1
  NAMESPACE: github-k8s-demo
  # name of the docker image to build, replace with the name
  # that will contain your dockerhub id
  IMAGE: ewelinawilkosz/github-k8s-demo
  # kosli variables - will be picked up by commands
  KOSLI_OWNER: demo
  KOSLI_PIPELINE: github-k8s-demo
  KOSLI_ENVIRONMENT: github-k8s-test
  KOSLI_CLI_VERSION: &#34;2.0.0&#34;

jobs:
  build-report:
    runs-on: ubuntu-20.04

    # outputs to be passed on to &#39;deploy&#39; job below
    outputs:
      tag: ${{ steps.prep.outputs.tag }}
      tagged-image: ${{ steps.prep.outputs.tagged-image }}
      image-digest: ${{ steps.digest-prep.outputs.image-digest }}

    steps:
    # checkout code
    - uses: actions/checkout@v2
      with:
        fetch-depth: 1

    - name: Prepare
      id: prep
      run: |
        TAG=$(echo $GITHUB_SHA | head -c7)
        TAGGED_IMAGE=${{ env.IMAGE }}:${TAG}
        echo &#34;TAG=${TAG}&#34; &gt;&gt; ${GITHUB_ENV}
        echo &#34;TAGGED_IMAGE=${TAGGED_IMAGE}&#34; &gt;&gt; ${GITHUB_ENV}
        echo ::set-output name=tag::${TAG}
        echo ::set-output name=tagged-image::${TAGGED_IMAGE}

    # This is the a separate action that sets up buildx (buildkit) runner
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v1

    # use your own username and configured token to log into dockerhub
    - name: Login to hub.docker.com
      uses: docker/login-action@v1
      with:
        username: ewelinawilkosz
        password: ${{ secrets.DOCKERHUB_TOKEN }}

    - name: Build and push Docker image
      id: docker_build
      uses: docker/build-push-action@v2
      with:
        push: true
        tags: ${{ env.TAGGED_IMAGE }}
        no-cache: true

    # the digest will be passed to kosli commands using &#39;sha256&#39; flags
    - name: Make the image digest available for following steps
      id: digest-prep
      run: |
        ARTIFACT_SHA=$( echo ${{ steps.docker_build.outputs.digest }} | sed &#39;s/.*://&#39;)
        echo &#34;DIGEST=$ARTIFACT_SHA&#34; &gt;&gt; ${GITHUB_ENV}
        echo ::set-output name=image-digest::${ARTIFACT_SHA}

    - name: Download Kosli cli client
      id: download-kosli-cli
      run: |
        wget https://github.com/kosli-dev/cli/releases/download/v${{ env.KOSLI_CLI_VERSION }}/kosli_${{ env.KOSLI_CLI_VERSION }}_linux_amd64.tar.gz
        tar -xf kosli_${{ env.KOSLI_CLI_VERSION }}_linux_amd64.tar.gz kosli

    - name: Declare pipeline in Kosli
      env:
        KOSLI_API_TOKEN: ${{ secrets.KOSLI_API_TOKEN }}
      run:
        ./kosli pipeline declare
          --description &#34;Kosli server&#34;
          --pipeline ${{ env.KOSLI_PIPELINE }}
          --template &#34;artifact&#34;

    - name: Report Docker image in Kosli
      env:
        KOSLI_API_TOKEN: ${{ secrets.KOSLI_API_TOKEN }}
      run:
        ./kosli pipeline artifact report creation ${{ env.TAGGED_IMAGE }}
          --sha256 ${{ env.DIGEST }}

  # deploy review environment
  deploy:
    needs: [build-report]
    runs-on: ubuntu-20.04

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 1

    - id: auth
      uses: google-github-actions/auth@v0.4.0
      with:
        credentials_json: ${{ secrets.GCP_K8S_CREDENTIALS }}

    - id: connect-to-k8s
      uses: google-github-actions/get-gke-credentials@main
      with:
        cluster_name: ${{ env.K8S_CLUSTER_NAME }}
        location: ${{ env.K8S_GCP_ZONE }}

    - uses: azure/setup-kubectl@v1
      id: install-kubectl

    # The KUBECONFIG env var is automatically exported and picked up by kubectl.
    - name: Ensure review env namespace
      run: |
        kubectl get namespace ${{ env.NAMESPACE }} || kubectl create namespace ${{ env.NAMESPACE }}

    - name: Deploy
      run: |
        sed -i &#39;s/TAG/${{ needs.build-report.outputs.tag }}/g&#39; k8s/deployment.yaml
        kubectl apply -f k8s/deployment.yaml -n ${{ env.NAMESPACE }}
</code></pre><p>Once the workflow runs succesfully, you should see it reported in Kosli <strong>github-k8s-demo pipeline</strong>:</p><p><img src=/images/artifact-list.png alt="Compliant artifact with no deployments"></p><p>With more details once you click on it:</p><p><img src=/images/artifact-no-deployment.png alt="Compliant artifact with no deployments"></p><p>You will also notice a change in the state of your <strong>github-k8s-test</strong> environment (if the environment reporting workflow ran successfully): it is still incompliant, but now the artifact running there has provenance (you can see the name of Kosli <strong>pipeline: github-k8s-demo</strong> that the artifact was reported to, in a grey, pill shaped field) so we can check how it was built:</p><p><img src=/images/env-provenance.png alt="Incompliant environment, artifact with provenance"></p><p>Now that your aritfact reporting works the only thing missing is reporting the deployment.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main><div class=top-header><div class="container flex"><div class=docs-logo><a href=/><img src=/kosli-docs-logo-white.svg alt="Kosli docs logo"></a></div><div class=separator></div><div class=back-to-site><a href=https://www.kosli.com target=_blank><span class=left-carret>&lt;</span> Back to Website</a></div></div></div></body></html>