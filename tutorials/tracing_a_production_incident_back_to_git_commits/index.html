<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tracing a production incident back to git commits # In this short tutorial you'll learn how Kosli helps Cyber-dojo to track a production incident back to git commits.
Something went wrong and https://cyber-dojo.org is displaying a 500 error!
It was working an hour ago. What has happened in the last hour?
Start with the environment # https://cyber-dojo.org is running in an AWS environment that reports to Kosli as aws-prod."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Tracing a production incident back to git commits"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://docs.kosli.com/tutorials/tracing_a_production_incident_back_to_git_commits/"><title>Tracing a production incident back to git commits | Kosli developer documentation</title><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=stylesheet href=/book.min.63b164298756b66717a1db36ea286149e22b5c43671b6aaa42ed1c716c14cb03.css integrity="sha256-Y7FkKYdWtmcXods26ihhSeIrXENnG2qqQu0ccWwUywM=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.608529ec70e30c3ac5016f5c198749e7e8f5d34cc9a7117d1adbd24d629e3835.js integrity="sha256-YIUp7HDjDDrFAW9cGYdJ5+j100zJpxF9GtvSTWKeODU=" crossorigin=anonymous></script>
<link rel=alternate type=application/rss+xml href=https://docs.kosli.com/tutorials/tracing_a_production_incident_back_to_git_commits/index.xml title="Kosli developer documentation"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Kosli developer documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-cecd4ea74d1b57416f3e6afae6030290 class=toggle>
<label for=section-cecd4ea74d1b57416f3e6afae6030290 class="flex justify-between"><a href=https://docs.kosli.com/guides/>Guides</a></label><ul><li><input type=checkbox id=section-70f06323c9fc8771b6f6b6608e912f12 class=toggle>
<label for=section-70f06323c9fc8771b6f6b6608e912f12 class="flex justify-between"><a href=https://docs.kosli.com/guides/github_actions_and_k8s/>GitHub Actions and k8s</a></label><ul><li><a href=https://docs.kosli.com/guides/github_actions_and_k8s/prerequisites/>Prerequisites</a></li><li><a href=https://docs.kosli.com/guides/github_actions_and_k8s/report_environment/>Report Environment</a></li><li><a href=https://docs.kosli.com/guides/github_actions_and_k8s/report_artifact/>Report Artifact</a></li><li><a href=https://docs.kosli.com/guides/github_actions_and_k8s/report_deployment/>Report Deployment</a></li></ul></li></ul></li><li><a href=https://docs.kosli.com/installation/>Installing the Kosli CLI</a><ul></ul></li><li><input type=checkbox id=section-90d1aeee0e96e115d1edea3b994d19fb class=toggle checked>
<label for=section-90d1aeee0e96e115d1edea3b994d19fb class="flex justify-between"><a href=https://docs.kosli.com/tutorials/>Tutorials</a></label><ul><li><a href=https://docs.kosli.com/tutorials/following_a_git_commit_to_runtime_environments/>Following a git commit to runtime environments</a><ul></ul></li><li><a href=https://docs.kosli.com/tutorials/tracing_a_production_incident_back_to_git_commits/ class=active>Tracing a production incident back to git commits</a><ul></ul></li><li><a href=https://docs.kosli.com/tutorials/simulating_a_devops_system/>Simulating a DevOps system</a><ul></ul></li></ul></li><li><input type=checkbox id=section-dc8a1c63e6da60163016ce21cae1faa0 class=toggle>
<label for=section-dc8a1c63e6da60163016ce21cae1faa0 class="flex justify-between"><a href=https://docs.kosli.com/concepts/>Concepts</a></label><ul><li><a href=https://docs.kosli.com/concepts/environments/>Environments</a></li><li><a href=https://docs.kosli.com/concepts/pipelines/>Pipelines</a></li></ul></li><li><input type=checkbox id=section-3993beb65ef7e76a7dbe6e66c07255ac class=toggle>
<label for=section-3993beb65ef7e76a7dbe6e66c07255ac class="flex justify-between"><a href=https://docs.kosli.com/client_reference/>Kosli Commands</a></label><ul><li><a href=https://docs.kosli.com/client_reference/kosli/>kosli</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_get/>kosli approval get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_ls/>kosli approval ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_get/>kosli artifact get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_ls/>kosli artifact ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_artifact/>kosli assert artifact</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_bitbucket-pullrequest/>kosli assert bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_environment/>kosli assert environment</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_github-pullrequest/>kosli assert github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_status/>kosli assert status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_get/>kosli deployment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_ls/>kosli deployment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_allowedartifacts_add/>kosli environment allowedartifacts add</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_declare/>kosli environment declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_diff/>kosli environment diff</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_get/>kosli environment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_inspect/>kosli environment inspect</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_log/>kosli environment log</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_ls/>kosli environment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_ecs/>kosli environment report ecs</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_k8s/>kosli environment report k8s</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_lambda/>kosli environment report lambda</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_s3/>kosli environment report s3</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_server/>kosli environment report server</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_fingerprint/>kosli fingerprint</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_assert/>kosli pipeline approval assert</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_report/>kosli pipeline approval report</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_request/>kosli pipeline approval request</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_creation/>kosli pipeline artifact report creation</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_bitbucket-pullrequest/>kosli pipeline artifact report evidence bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_generic/>kosli pipeline artifact report evidence generic</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_github-pullrequest/>kosli pipeline artifact report evidence github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_test/>kosli pipeline artifact report evidence test</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_declare/>kosli pipeline declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_deployment_report/>kosli pipeline deployment report</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_inspect/>kosli pipeline inspect</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_ls/>kosli pipeline ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_status/>kosli status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_version/>kosli version</a></li></ul></li><li><input type=checkbox id=section-d06928ff9c11121b26f141ced850796c class=toggle>
<label for=section-d06928ff9c11121b26f141ced850796c class="flex justify-between"><a href=https://docs.kosli.com/helm/>Helm</a></label><ul><li><a href=https://docs.kosli.com/helm/helm_chart/>Helm Chart</a></li></ul></li><li><a href=https://docs.kosli.com/ci-defaults/>Defaulted command flags from CI</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Tracing a production incident back to git commits</strong>
<label for=toc-control></label></div></header><article class=markdown><h1 id=tracing-a-production-incident-back-to-git-commits>Tracing a production incident back to git commits
<a class=anchor href=#tracing-a-production-incident-back-to-git-commits>#</a></h1><p>In this short tutorial you'll learn how Kosli helps Cyber-dojo to track a production incident back to git commits.</p><p>Something went wrong and <a href=https://cyber-dojo.org target=_blank>https://cyber-dojo.org</a> is displaying a 500 error!</p><figure><img src=/images/cyber-dojo-prod-500-large.png alt="Prod cyber-dojo is down with a 500" width=90%></figure><p>It was working an hour ago. What has happened in the last hour?</p><h2 id=start-with-the-environment>Start with the environment
<a class=anchor href=#start-with-the-environment>#</a></h2><p><a href=https://cyber-dojo.org target=_blank>https://cyber-dojo.org</a> is running in an AWS environment
that reports to Kosli as <code>aws-prod</code>.<br>You can get a log of this environment's changes.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli env log aws-prod --long
</span></span></code></pre></div><p>You will see more than 177 snapshots because
<code>aws-prod</code> has moved on since this incident (it has been resolved with new
commits which have created new deployments). To get the same output as we have
you can set the interval for the command</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli env log aws-prod --long 175..177
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>SNAPSHOT  EVENT                                                                      PIPELINE  DEPLOYMENTS
</span></span><span style=display:flex><span>#177      Artifact: 274425519734.dkr.ecr.eu-central-1.amazonaws.com/creator:31dee35  creator   #87 
</span></span><span style=display:flex><span>          SHA256: 5d1c926530213dadd5c9fcbf59c8822da56e32a04b0f9c774d7cdde3cf6ba66d             
</span></span><span style=display:flex><span>          Description: 1 instance stopped running (from 1 to 0).                               
</span></span><span style=display:flex><span>          Reported at: Tue, 06 Sep 2022 16:53:28 CEST                                          
</span></span><span style=display:flex><span>                                                                                               
</span></span><span style=display:flex><span>#176      Artifact: 274425519734.dkr.ecr.eu-central-1.amazonaws.com/creator:b7a5908  creator   #89 
</span></span><span style=display:flex><span>          SHA256: 860ad172ace5aee03e6a1e3492a88b3315ecac2a899d4f159f43ca7314290d5a             
</span></span><span style=display:flex><span>          Description: 1 instance started running (from 0 to 1).                               
</span></span><span style=display:flex><span>          Reported at: Tue, 06 Sep 2022 16:52:28 CEST
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>These two snapshots belong to the same blue-green deployment.
We see artifact <code>creator:b7a5908</code> starting in snapshot #176, and artifact
<code>creator:31dee35</code> exiting in snapshot #177.</p><blockquote class="book-hint info"><h3 id=how-do-we-know-we-are-seeing-a-blue-green-deployment>How do we know we are seeing a blue-green deployment?
<a class=anchor href=#how-do-we-know-we-are-seeing-a-blue-green-deployment>#</a></h3><p>We know that these two snapshot events:</p><ul><li>relate to the same pipeline</li><li>are close in time</li></ul></blockquote><h2 id=dig-into-the-artifact>Dig into the artifact
<a class=anchor href=#dig-into-the-artifact>#</a></h2><p>We are interested in #176, showing the newly running artifact, <code>creator:b7a5908</code>,
whos sha256 is <code>860ad172ace5aee03e6a1e3492a88b3315ecac2a899d4f159f43ca7314290d5a</code>.</p><p>Let's learn more about this artifact.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli artifact get creator@860ad172ace5aee03e6a1e3492a88b3315ecac2a899d4f159f43ca7314290d5a
</span></span></code></pre></div><div class="highlight light-console"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Name:        cyberdojo/creator:b7a5908
</span></span><span style=display:flex><span>SHA256:      860ad172ace5aee03e6a1e3492a88b3315ecac2a899d4f159f43ca7314290d5a
</span></span><span style=display:flex><span>Created on:  Tue, 06 Sep 2022 16:48:07 CEST â€¢ 21 hours ago
</span></span><span style=display:flex><span>Git commit:  b7a590836cf140e17da3f01eadd5eca17d9efc65
</span></span><span style=display:flex><span>Commit URL:  https://github.com/cyber-dojo/creator/commit/b7a590836cf140e17da3f01eadd5eca17d9efc65
</span></span><span style=display:flex><span>Build URL:   https://github.com/cyber-dojo/creator/actions/runs/3001102984
</span></span><span style=display:flex><span>State:       COMPLIANT
</span></span><span style=display:flex><span>History:  
</span></span><span style=display:flex><span>    Artifact created                               Tue, 06 Sep 2022 16:48:07 CEST
</span></span><span style=display:flex><span>    Deployment #88 to aws-beta environment         Tue, 06 Sep 2022 16:49:59 CEST
</span></span><span style=display:flex><span>    Deployment #89 to aws-prod environment         Tue, 06 Sep 2022 16:51:12 CEST
</span></span><span style=display:flex><span>    Started running in aws-beta#196 environment    Tue, 06 Sep 2022 16:51:42 CEST
</span></span><span style=display:flex><span>    Started running in aws-prod#176 environment    Tue, 06 Sep 2022 16:52:28 CEST
</span></span></code></pre></div><h2 id=follow-to-the-commit>Follow to the commit
<a class=anchor href=#follow-to-the-commit>#</a></h2><p>You can follow the <a href=https://github.com/cyber-dojo/creator/commit/b7a590836cf140e17da3f01eadd5eca17d9efc65 target=_blank>commit URL
</a>.</p><figure><img src=/images/cyber-dojo-github-diff.png alt="cyber-dojo github diff" width=500></figure><p>The incident was caused by a simple typo in the <code>app.rb</code> file!</p><p>Perhaps someone accidentally inserted the "s" while trying to save the file?
Either way, this is clearly the problem because there is no function called <code>responds_to</code>.</p><p>We were able to trace the problem back to a specific commit without any access to cyber-dojo's <code>aws-prod</code> environment.</p><h3 id=see-also-the-other-tutorials>See also the other tutorials:
<a class=anchor href=#see-also-the-other-tutorials>#</a></h3><ul><li><a href=../following_a_git_commit_to_runtime_environments/>Following a git commit to runtime environments</a></li><li><a href=../simulating_a_devops_system/>Simulating a DevOps system</a></li></ul><ul class=contents></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){document.querySelectorAll("div.command").forEach(e=>{let t=document.createElement("div"),n=document.createTextNode("Copied!");t.appendChild(n),e.appendChild(t),t.classList.add("copiedText"),e.addEventListener("click",function(){if(navigator.clipboard){let n=e.querySelector("code");navigator.clipboard.writeText(n.innerText),t.classList.add("visible"),setTimeout(()=>{t.classList.remove("visible")},1500)}})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main><div class=top-header><div class="container flex"><div class=docs-logo><a href=/><img src=/kosli-docs-logo-white.svg alt="Kosli docs logo"></a></div><div class=separator></div></div></div></body></html>