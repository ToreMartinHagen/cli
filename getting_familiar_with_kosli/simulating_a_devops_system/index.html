<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Preparing the tutorial # For these examples we are simulating a system with source code, build and a running server. We have a script to help you run these simulations so you don't need to type so many commands.
You can download the file from here: https://raw.githubusercontent.com/kosli-dev/cli/main/simulation_commands.bash
or from the command line with
cd /tmp curl -O https://raw.githubusercontent.com/kosli-dev/cli/main/simulation_commands.bash Source the simulation commands so you can use them later on in the examples."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Simulating a DevOps system"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://docs.kosli.com/getting_familiar_with_kosli/simulating_a_devops_system/"><title>Simulating a DevOps system | Kosli developer documentation</title><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=stylesheet href=/book.min.2209f42b4d823c04d7813187fe8e166480d9e57b244ba3efd71c2eed83326b5f.css integrity="sha256-Ign0K02CPATXgTGH/o4WZIDZ5XskS6Pv1xwu7YMya18=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.9c1e051dea9c6aa9525f51b71f591a38de62f25e547e6fcdf4cda802a5a65ced.js integrity="sha256-nB4FHeqcaqlSX1G3H1kaON5i8l5Ufm/N9M2oAqWmXO0=" crossorigin=anonymous></script>
<link rel=alternate type=application/rss+xml href=https://docs.kosli.com/getting_familiar_with_kosli/simulating_a_devops_system/index.xml title="Kosli developer documentation"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Kosli developer documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-88ce4fcfc81f5fbcc629e032a4440ec3 class=toggle checked>
<label for=section-88ce4fcfc81f5fbcc629e032a4440ec3 class="flex justify-between"><a href=https://docs.kosli.com/getting_familiar_with_kosli/>Getting Familiar with Kosli</a></label><ul><li><a href=https://docs.kosli.com/getting_familiar_with_kosli/installation/>Installing Kosli CLI</a><ul></ul></li><li><a href=https://docs.kosli.com/getting_familiar_with_kosli/simulating_a_devops_system/ class=active>Simulating a DevOps system</a><ul></ul></li></ul></li><li><input type=checkbox id=section-90d1aeee0e96e115d1edea3b994d19fb class=toggle>
<label for=section-90d1aeee0e96e115d1edea3b994d19fb class="flex justify-between"><a href=https://docs.kosli.com/tutorials/>Tutorials</a></label><ul><li><input type=checkbox id=section-7eca5fc2ae3a7a6d5837431d0a2728d1 class=toggle>
<label for=section-7eca5fc2ae3a7a6d5837431d0a2728d1 class="flex justify-between"><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/>GitHub Actions and k8s</a></label><ul><li><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/prerequisites/>Prerequisites</a></li><li><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/report_environment/>Report Environment</a></li><li><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/report_artifact/>Report Artifact</a></li><li><a href=https://docs.kosli.com/tutorials/github_actions_and_k8s/report_deployment/>Report Deployment</a></li></ul></li></ul></li><li><input type=checkbox id=section-dc8a1c63e6da60163016ce21cae1faa0 class=toggle>
<label for=section-dc8a1c63e6da60163016ce21cae1faa0 class="flex justify-between"><a href=https://docs.kosli.com/concepts/>Concepts</a></label><ul><li><a href=https://docs.kosli.com/concepts/environments/>Environments</a></li><li><a href=https://docs.kosli.com/concepts/pipelines/>Pipelines</a></li></ul></li><li><input type=checkbox id=section-3993beb65ef7e76a7dbe6e66c07255ac class=toggle>
<label for=section-3993beb65ef7e76a7dbe6e66c07255ac class="flex justify-between"><a href=https://docs.kosli.com/client_reference/>Kosli Commands</a></label><ul><li><a href=https://docs.kosli.com/client_reference/kosli/>kosli</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_get/>kosli approval get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_approval_ls/>kosli approval ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_get/>kosli artifact get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_artifact_ls/>kosli artifact ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_artifact/>kosli assert artifact</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_bitbucket-pullrequest/>kosli assert bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_environment/>kosli assert environment</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_github-pullrequest/>kosli assert github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_assert_status/>kosli assert status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_get/>kosli deployment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_deployment_ls/>kosli deployment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_allowedartifacts_add/>kosli environment allowedartifacts add</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_declare/>kosli environment declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_diff/>kosli environment diff</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_get/>kosli environment get</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_inspect/>kosli environment inspect</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_log/>kosli environment log</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_ls/>kosli environment ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_ecs/>kosli environment report ecs</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_k8s/>kosli environment report k8s</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_lambda/>kosli environment report lambda</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_s3/>kosli environment report s3</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_environment_report_server/>kosli environment report server</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_fingerprint/>kosli fingerprint</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_assert/>kosli pipeline approval assert</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_report/>kosli pipeline approval report</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_approval_request/>kosli pipeline approval request</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_creation/>kosli pipeline artifact report creation</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_bitbucket-pullrequest/>kosli pipeline artifact report evidence bitbucket-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_generic/>kosli pipeline artifact report evidence generic</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_github-pullrequest/>kosli pipeline artifact report evidence github-pullrequest</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_artifact_report_evidence_test/>kosli pipeline artifact report evidence test</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_declare/>kosli pipeline declare</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_deployment_report/>kosli pipeline deployment report</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_inspect/>kosli pipeline inspect</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_pipeline_ls/>kosli pipeline ls</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_status/>kosli status</a></li><li><a href=https://docs.kosli.com/client_reference/kosli_version/>kosli version</a></li></ul></li><li><input type=checkbox id=section-d06928ff9c11121b26f141ced850796c class=toggle>
<label for=section-d06928ff9c11121b26f141ced850796c class="flex justify-between"><a href=https://docs.kosli.com/helm/>Helm</a></label><ul><li><a href=https://docs.kosli.com/helm/helm_chart/>Helm Chart</a></li></ul></li><li><a href=https://docs.kosli.com/ci-defaults/>Defaulted command flags from CI</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Simulating a DevOps system</strong>
<label for=toc-control></label></div></header><article class=markdown><h1 id=preparing-the-tutorial>Preparing the tutorial
<a class=anchor href=#preparing-the-tutorial>#</a></h1><p>For these examples we are simulating a system with source code, build and a running server.
We have a script to help you run these simulations so you don't need to type so many commands.</p><p>You can download the file from here:
<a href=https://raw.githubusercontent.com/kosli-dev/cli/main/simulation_commands.bash>https://raw.githubusercontent.com/kosli-dev/cli/main/simulation_commands.bash</a></p><p>or from the command line with</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd /tmp
</span></span><span style=display:flex><span>curl -O https://raw.githubusercontent.com/kosli-dev/cli/main/simulation_commands.bash
</span></span></code></pre></div><p>Source the simulation commands so you can use them later on in the examples.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>source simulation_commands.bash
</span></span></code></pre></div><p>To see what a command (eg create_git_repo_in_tmp) in the simulation is actually doing run</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>type create_git_repo_in_tmp
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>create_git_repo_in_tmp is a <span style=color:#66d9ef>function</span>
</span></span><span style=display:flex><span>create_git_repo_in_tmp <span style=color:#f92672>()</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>{</span> 
</span></span><span style=display:flex><span>    pushd /tmp;
</span></span><span style=display:flex><span>    mkdir try-kosli;
</span></span><span style=display:flex><span>    ...
</span></span></code></pre></div><p>Create the git repo and simulate a build and deployment to server.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>create_git_repo_in_tmp
</span></span><span style=display:flex><span>simulate_build
</span></span><span style=display:flex><span>simulate_deployment
</span></span></code></pre></div><p>While going through the getting started guide, feel free to explore the
functionality by updating the source code, building and deploying new versions.</p><blockquote class="book-hint info"><h2 id=using-a-web-browser>Using a web browser
<a class=anchor href=#using-a-web-browser>#</a></h2><p>As you go through the guide you can also check your progress from
<a href=https://app.kosli.com>your browser</a>.</p><p>In the upper left corner there is a house icon. Next to it you can select
which organization you want to view. Your personal organization
has the same name as your github login name, and is the organization you will
be using in this guide.</p></blockquote><h1 id=environment>Environment
<a class=anchor href=#environment>#</a></h1><p>A Kosli environment stores information about
what SW is running in your actual runtime environment (server, Kubernetes cluster, AWS, ...)
We use one Kosli environment per runtime environment.</p><p>A typical setup reports what is running on the
staging server and on the production server. To report what is
running you run the Kosli CLI command periodically. The Kosli CLI will
detect the version of the SW you are currently running and report
it to the Kosli environment.</p><h2 id=creating-a-kosli-environment>Creating a Kosli environment
<a class=anchor href=#creating-a-kosli-environment>#</a></h2><p>To follow the examples make sure you have followed the instructions in Local setup</p><p>We create a Kosli environment.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment declare <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --environment-type server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;Production server (for kosli getting started)&#34;</span>
</span></span></code></pre></div><p>You can immediately verify that the Kosli environment was created:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment ls
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME        TYPE    LAST REPORT  LAST MODIFIED
</span></span><span style=display:flex><span>production  server               2022-08-16T07:53:43+02:00
</span></span></code></pre></div><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment inspect production
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Name:              production
</span></span><span style=display:flex><span>Type:              server
</span></span><span style=display:flex><span>Description:       Production server <span style=color:#f92672>(</span><span style=color:#66d9ef>for</span> kosli getting started<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>State:             N/A
</span></span><span style=display:flex><span>Last Reported At:  N/A
</span></span></code></pre></div><p>In the web interface you can select the <strong>Environments</strong> menu on the left.
It will show you that you have a <em>production</em> environment and that
no reports have been received.</p><h2 id=reporting-the-sw-running-in-your-environment>Reporting the SW running in your environment
<a class=anchor href=#reporting-the-sw-running-in-your-environment>#</a></h2><p>We simulate a report from our server by reporting two dummy files for the web and
database applications.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment report server production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/web_*bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/db_*.bin
</span></span></code></pre></div><p>We can see that the server has started, and how long it has run.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment log production
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SNAPSHOT  FROM                  TO   DURATION
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 07:54 CEST  now  <span style=color:#ae81ff>11</span> seconds
</span></span></code></pre></div><p>We can get a more detailed view of what is currently running on the server.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment get production
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>COMMIT  ARTIFACT                                                                  PIPELINE  RUNNING_SINCE  REPLICAS
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/web_1.bin                                     N/A       <span style=color:#ae81ff>2</span> minutes ago  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        SHA256: a7a87c332500a40f9a01b811ec75f51b40188a3dabd205feb0fa7c3eafb25fbe                           
</span></span><span style=display:flex><span>                                                                                                           
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/db_1.bin                                      N/A       <span style=color:#ae81ff>2</span> minutes ago  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        SHA256: 0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af                           
</span></span></code></pre></div><p>If you refresh the environment page in the web browser you can see that we have
a time-stamp for when the environment changed. Pressing the <em>production</em> link
gives you a detailed view of what is running now.</p><p>Typically a server periodically sends a report of what is currently running to Kosli. Kosli
only creates a new snapshot if the report has changes compared to previous snapshot, so resending the same environment report
several times will not lead to duplication of snapshots.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment report server production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/web_*bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/db_*.bin
</span></span></code></pre></div><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment log production
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SNAPSHOT  FROM                  TO   DURATION
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 07:54 CEST  now  <span style=color:#ae81ff>11</span> seconds
</span></span></code></pre></div><p>We simulate an update of the web application to a new version, build and deploy it</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>update_web_src
</span></span><span style=display:flex><span>simulate_build
</span></span><span style=display:flex><span>simulate_deployment
</span></span></code></pre></div><p>Report what is now running on server</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment report server production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/web_*bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --paths /tmp/try-kosli/server/db_*.bin
</span></span></code></pre></div><p>We can see we have created a new snapshot.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment log production
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SNAPSHOT  FROM                  TO                    DURATION
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>         <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 07:58 CEST  now                   <span style=color:#ae81ff>9</span> seconds
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 07:54 CEST  <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 07:58 CEST  <span style=color:#ae81ff>4</span> minutes
</span></span></code></pre></div><p>We can see that we are currently running web version 2 in production.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment get production
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>COMMIT  ARTIFACT                                                                  PIPELINE  RUNNING_SINCE   REPLICAS
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/web_2.bin                                     N/A       <span style=color:#ae81ff>39</span> seconds ago  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        SHA256: cbc92ce1291830382ec23b95efc213d6e1725b5157bcb2927d48296b61c86746                            
</span></span><span style=display:flex><span>                                                                                                            
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/db_1.bin                                      N/A       <span style=color:#ae81ff>6</span> minutes ago   <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        SHA256: 0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af                            
</span></span></code></pre></div><p>Here, using the bare environment name (eg production) always refers to the latest snapshot
in that environment. We can also use the
Kosli CLI to check what was running in previous snapshots.
Here we look at what was running in snapshot #1 in production.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli environment get production#1
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>COMMIT  ARTIFACT                                                                  PIPELINE  RUNNING_SINCE  REPLICAS
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/web_1.bin                                     N/A       <span style=color:#ae81ff>7</span> minutes ago  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        SHA256: a7a87c332500a40f9a01b811ec75f51b40188a3dabd205feb0fa7c3eafb25fbe                           
</span></span><span style=display:flex><span>                                                                                                           
</span></span><span style=display:flex><span>N/A     Name: /tmp/try-kosli/server/db_1.bin                                      N/A       <span style=color:#ae81ff>7</span> minutes ago  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        SHA256: 0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af                           
</span></span></code></pre></div><p>In the web interface you should now also be able to see 2 snapshots. The Log
tab should show what changed in snapshot 1 and snapshot 2.</p><h1 id=pipelines>Pipelines
<a class=anchor href=#pipelines>#</a></h1><p>A Kosli pipeline stores information about what happens in your build system.
The output of the build system is called an <em>artifact</em> in Kosli. This can be
an application, docker image, documentation, filesystem and so on.</p><p>Some organizations have a CI system where one CI pipeline builds one
artifact, some have a CI system where one CI pipeline builds several
artifacts. For both cases we use one Kosli pipeline for each artifact.
We use the Kosli CLI to report information about the creation of an
artifact to the Kosli pipeline.</p><p>A Kosli pipeline can also be used to store any information related to
the artifact you have built, like test results, manual approvals,
pull-requests and so on.</p><h2 id=creating-a-kosli-pipeline>Creating a Kosli pipeline
<a class=anchor href=#creating-a-kosli-pipeline>#</a></h2><p>To follow the examples make sure you have followed the instructions in Local setup.</p><p>We create a Kosli pipeline where we can report what SW our CI system
is building. Since we are building two applications we are making
two Kosli pipelines <code>web-server</code> and <code>database-server</code>.</p><p>Create your new pipelines:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline declare <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline web-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;pipeline to build web-server&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --visibility private <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --template artifact
</span></span></code></pre></div><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline declare <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline database-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;pipeline to build database-server&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --visibility private <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --template artifact
</span></span></code></pre></div><p>You can immediately verify the Kosli pipelines were created:</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline ls
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>NAME             DESCRIPTION                        VISIBILITY
</span></span><span style=display:flex><span>database-server  pipeline to build database-server  private
</span></span><span style=display:flex><span>web-server       pipeline to build web-server       private
</span></span></code></pre></div><p>In the web interface you can select the <strong>Pipelines</strong> menu on the left.
It will show you that you have a <em>web-server</em> and <em>database-server</em> pipeline.
If you press either of the pipelines they will show that no artifacts have
been reported for the pipelines.</p><h2 id=building-artifacts-and-reporting-them-to-kosli>Building artifacts and reporting them to Kosli
<a class=anchor href=#building-artifacts-and-reporting-them-to-kosli>#</a></h2><p>Simulate building our SW</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>simulate_build
</span></span></code></pre></div><p>We can now report we have built the web and database applications. We are using
a dummy <code>--build-url</code>, in real life it would be a CI build URL.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline artifact report creation /tmp/try-kosli/build/web_<span style=color:#66d9ef>$(</span>cat /tmp/try-kosli/code/web.src<span style=color:#66d9ef>)</span>.bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline web-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --artifact-type file <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --build-url file://dummy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --commit-url file:///tmp/try-kosli/code <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --git-commit <span style=color:#66d9ef>$(</span>cd /tmp/try-kosli/code; git rev-parse HEAD<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline artifact report creation /tmp/try-kosli/build/db_<span style=color:#66d9ef>$(</span>cat /tmp/try-kosli/code/db.src<span style=color:#66d9ef>)</span>.bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline database-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --artifact-type file <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --build-url file://dummy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --commit-url file:///tmp/try-kosli/code <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --git-commit <span style=color:#66d9ef>$(</span>cd /tmp/try-kosli/code; git rev-parse HEAD<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>We can see we have built one artifact in our <em>web-server</em> pipeline</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli artifact ls web-server
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>COMMIT   ARTIFACT                                                                  STATE      CREATED_AT
</span></span><span style=display:flex><span><span style=color:#ae81ff>5187374</span>  Name: web_2.bin                                                           COMPLIANT  <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 08:00 CEST
</span></span><span style=display:flex><span>         SHA256: cbc92ce1291830382ec23b95efc213d6e1725b5157bcb2927d48296b61c86746             
</span></span></code></pre></div><p>And one for the <em>database-server</em> pipeline</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli artifact ls database-server
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>COMMIT   ARTIFACT                                                                  STATE      CREATED_AT
</span></span><span style=display:flex><span><span style=color:#ae81ff>5187374</span>  Name: db_1.bin                                                            COMPLIANT  <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 08:01 CEST
</span></span><span style=display:flex><span>         SHA256: 0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af             
</span></span></code></pre></div><p>We can also get detailed information about each artifact that has been reported.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli artifact get database-server@0efde582a933f011c3ae9007467a7f973a874517093e9a5a05ea55476f7c91af
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Name:         db_1.bin
</span></span><span style=display:flex><span>State:        COMPLIANT
</span></span><span style=display:flex><span>Git commit:   518737485e5150ee6255a1c74749997d380c1708
</span></span><span style=display:flex><span>Build URL:    file://dummy
</span></span><span style=display:flex><span>Commit URL:   file:///tmp/try-kosli/code
</span></span><span style=display:flex><span>Created at:   <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 08:01 CEST • <span style=color:#ae81ff>2</span> hours ago
</span></span><span style=display:flex><span>Approvals:    None
</span></span><span style=display:flex><span>Deployments:  None
</span></span><span style=display:flex><span>Evidence:
</span></span></code></pre></div><p>In the web interface you can select the <em>database-server</em> pipeline and then the <em>db_1.bin</em>
artifact to get more details.</p><h1 id=deployments>Deployments
<a class=anchor href=#deployments>#</a></h1><p>We assume the user has done both Environments and Pipelines first.</p><p>A Kosli deployment command is used to indicate an aritfact is
being deployed to a given runtime environment.</p><h2 id=deploying-sw-to-the-server-and-reporting-the-deployment-to-kosli>Deploying SW to the server and reporting the deployment to Kosli
<a class=anchor href=#deploying-sw-to-the-server-and-reporting-the-deployment-to-kosli>#</a></h2><p>Simulate deploying our SW to the server</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>simulate_deployment
</span></span></code></pre></div><p>Report to Kosli that the web SW has been deployed.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli pipeline deployment report /tmp/try-kosli/build/web_<span style=color:#66d9ef>$(</span>cat /tmp/try-kosli/code/web.src<span style=color:#66d9ef>)</span>.bin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --pipeline web-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --artifact-type file <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --build-url file://dummy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --environment production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --description <span style=color:#e6db74>&#34;Web server version </span><span style=color:#66d9ef>$(</span>cat /tmp/try-kosli/code/web.src<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>We can verify the deployment with</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli deployment ls web-server
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ID   ARTIFACT                                                                  ENVIRONMENT  REPORTED_AT
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>    Name: web_2.bin                                                           production   <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 08:02 CEST
</span></span><span style=display:flex><span>     SHA256: cbc92ce1291830382ec23b95efc213d6e1725b5157bcb2927d48296b61c86746               
</span></span></code></pre></div><p>We can also get detailed information about a deployment.</p><div class="highlight command"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kosli deployment get web-server#1
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ID:               <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Artifact SHA256:  cbc92ce1291830382ec23b95efc213d6e1725b5157bcb2927d48296b61c86746
</span></span><span style=display:flex><span>Artifact name:    web_2.bin
</span></span><span style=display:flex><span>Build URL:        file://dummy
</span></span><span style=display:flex><span>Created at:       <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 08:02 CEST • <span style=color:#ae81ff>32</span> seconds ago
</span></span><span style=display:flex><span>Environment:      production
</span></span><span style=display:flex><span>Runtime state:    The artifact running since <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>22</span> 07:58 CEST
</span></span></code></pre></div><p>If you select the <em>web_2.bin</em> artifact in the web interface it will show
that it was part of Deployment #1 to <em>production</em> environment.</p><ul class=contents></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){document.querySelectorAll("div.command").forEach(e=>{let t=document.createElement("div"),n=document.createTextNode("Copied!");t.appendChild(n),e.appendChild(t),t.classList.add("copiedText"),e.addEventListener("click",function(){if(navigator.clipboard){let n=e.querySelector("code");navigator.clipboard.writeText(n.innerText),t.classList.add("visible"),setTimeout(()=>{t.classList.remove("visible")},1500)}})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main><div class=top-header><div class="container flex"><div class=docs-logo><a href=/><img src=/kosli-docs-logo-white.svg alt="Kosli docs logo"></a></div><div class=separator></div><div class=back-to-site><a href=https://www.kosli.com target=_blank><span class=left-carret>&lt;</span> Back to Website</a></div></div></div></body></html>